@use "../../styles/colors" as *;

.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 1rem;
  overflow-y: auto;
  animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.modal {
  background-color: get-theme-color("surface", "a10");
  border-radius: 1rem;
  max-width: 80vw;
  width: 100%;
  max-height: 95vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  animation: slideUp 0.3s ease-out;
  display: flex;
  flex-direction: column;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.closeButton {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  color: get-theme-color("text", "a30");
  font-size: 2rem;
  line-height: 1;
  cursor: pointer;
  padding: 0.5rem;
  width: 2.5rem;
  height: 2.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
  z-index: 10;

  &:hover {
    background-color: get-theme-color("surface", "a20");
    color: get-theme-color("text", "a0");
  }

  &:focus {
    outline: 2px solid get-theme-color("primary", "a0");
    outline-offset: 2px;
  }
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 1.5rem 4rem 1rem 1.5rem;
  border-bottom: 1px solid get-theme-color("surface", "a20");
  gap: 1rem;
}

.title {
  font-size: 1.5rem;
  font-weight: 700;
  color: get-theme-color("text", "a0");
  margin: 0;
  flex: 1;
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  min-width: 0;
}

.form {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
}

.content {
  display: grid;
  grid-template-columns: 250px 1fr;
  gap: 1.5rem;
  padding: 1.5rem;
  flex: 1;
  overflow-y: auto;
  min-height: 0;
}

.leftSidebar {
  display: flex;
  flex-direction: column;
}

.mainContent {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  min-width: 0;
}

.formGrid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

.seriesRow {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 2fr 1fr 1fr;
  gap: 1rem;
  align-items: end;

  // Ensure all children can shrink and don't overflow
  > * {
    min-width: 0;
  }
}

.seriesField {
  min-width: 0;
}

.numberField {
  min-width: 0;
}

.ratingField {
  min-width: 0;
  display: flex;
  flex-direction: column;

  // Ensure RatingInput container matches other input structures
  > div {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    width: 100%;
  }

  // Target the label to ensure it aligns with other labels
  label {
    font-size: 0.875rem;
    font-weight: 500;
    color: get-theme-color("text", "a10");
    line-height: 1.5;
  }

  // Target the stars container wrapper (the div with role="radiogroup")
  > div > div[role="radiogroup"] {
    // Input boxes have: padding 0.75rem top/bottom + line-height 1.5rem = ~3rem total height
    // Stars are ~2rem tall, so we add padding to center vertically
    padding: 0.5rem 0;
    min-height: 3rem;
    display: flex;
    align-items: center;
  }
}

.spanningRow {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  align-items: start;

  > * {
    min-width: 0;
  }
}

.descriptionSection {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-top: 0.5rem;
}

.richTextToolbar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  background-color: get-theme-color("surface", "a0");
  border: 1px solid get-theme-color("surface", "a20");
  border-top: none;
  border-radius: 0 0 0.375rem 0.375rem;
}

.toolbarButton {
  background: none;
  border: none;
  color: get-theme-color("text", "a30");
  cursor: pointer;
  padding: 0.375rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 0.25rem;
  transition: all 0.2s;

  span {
    font-size: 0.875rem;
  }

  &:hover {
    background-color: get-theme-color("surface", "a20");
    color: get-theme-color("text", "a0");
  }

  &:focus {
    outline: 2px solid get-theme-color("primary", "a0");
    outline-offset: 2px;
  }

  &:active {
    transform: scale(0.95);
  }
}

.toolbarSeparator {
  width: 1px;
  height: 1.5rem;
  background-color: get-theme-color("surface", "a20");
  margin: 0 0.25rem;
}

// Cover Section
.coverContainer {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.coverWrapper {
  position: relative;
  width: 100%;
  aspect-ratio: 2 / 3;
  border-radius: 0.5rem;
  overflow: hidden;
  background-color: get-theme-color("surface", "a20");
}

.cover {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.coverPlaceholder {
  width: 100%;
  aspect-ratio: 2 / 3;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(
    135deg,
    get-theme-color("surface", "a20") 0%,
    get-theme-color("surface", "a10") 100%
  );
  border-radius: 0.5rem;
  color: get-theme-color("text", "a40");
  font-size: 0.875rem;
}

.coverOverlay {
  position: absolute;
  bottom: 0.75rem;
  right: 0.75rem;
  display: flex;
  gap: 0.5rem;
  opacity: 1;
  z-index: 10;
}

.coverActionButton {
  width: 3rem;
  height: 3rem;
  min-width: 3rem;
  background-color: get-theme-color("primary", "a20");
  border: none;
  color: get-theme-color("surface", "a10");
  padding: 0;
  border-radius: 0.75rem;
  font-size: 0.875rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);

  span {
    font-size: 1.15rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  &:hover:not(:disabled) {
    background-color: get-theme-color("primary", "a10");
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  &:active:not(:disabled) {
    background-color: get-theme-color("primary", "a0");
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }

  &:focus {
    outline: 2px solid get-theme-color("primary", "a0");
    outline-offset: 2px;
  }

  &:disabled {
    background-color: get-theme-color("surface", "a30");
    color: get-theme-color("text", "a40");
    cursor: not-allowed;
    opacity: 0.5;
    box-shadow: none;
  }
}

.coverActions {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.coverAction {
  width: 100%;
  justify-content: flex-start;
  background: transparent !important;
  border: 1px solid get-theme-color("primary", "a20") !important;
  border-radius: 0.5rem;
  color: get-theme-color("primary", "a20") !important;

  &:hover {
    background-color: get-theme-color("surface", "a20") !important;
    border-color: get-theme-color("primary", "a10") !important;
  }

  &:focus {
    outline: 2px solid get-theme-color("primary", "a0");
    outline-offset: 2px;
  }

  span {
    margin-right: 0.5rem;
    color: get-theme-color("primary", "a20");
  }
}

.urlError {
  margin-top: 0.5rem;
  padding: 0.5rem 0.75rem;
  color: get-theme-color("danger", "a10");
  font-size: 0.875rem;
  line-height: 1.5;
  border-radius: 0.375rem;
  background-color: get-theme-color("danger", "a20");
}

// Formats Section
.formatsSection {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-top: 1.5rem;
}

.formatsTitle {
  font-size: 1.25rem;
  font-weight: 700;
  color: get-theme-color("text", "a0");
  margin: 0;
}

.formatsList {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.formatItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background-color: get-theme-color("surface-tonal", "a10");
  border: 1px solid get-theme-color("surface", "a20");
  border-radius: 0.375rem;
  gap: 0.75rem;
}

.formatIcon {
  width: 2.5rem;
  height: 2.5rem;
  min-width: 2.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: get-theme-color("surface", "a20");
  border-radius: 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: get-theme-color("text", "a0");
}

.formatInfo {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  flex: 1;
  min-width: 0;
}

.formatName {
  font-weight: 600;
  color: get-theme-color("text", "a0");
  font-size: 0.875rem;
}

.formatSize {
  color: get-theme-color("text", "a30");
  font-size: 0.875rem;
}

.formatActions {
  display: flex;
  gap: 0.25rem;
}

.formatActionButton {
  background: none;
  border: none;
  color: get-theme-color("text", "a30");
  cursor: pointer;
  padding: 0.375rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 0.25rem;
  transition: all 0.2s;
  flex-shrink: 0;

  span {
    font-size: 0.875rem;
  }

  &:hover {
    background-color: get-theme-color("surface", "a20");
    color: get-theme-color("primary", "a0");
  }

  &:focus {
    outline: 2px solid get-theme-color("primary", "a0");
    outline-offset: 2px;
  }

  &:active {
    transform: scale(0.95);
  }
}

.formatButtons {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.formatAction {
  width: 100%;
  justify-content: flex-start;
  background: transparent !important;
  border: 1px solid get-theme-color("primary", "a20") !important;
  border-radius: 0.5rem;
  color: get-theme-color("primary", "a20") !important;

  &:hover {
    background-color: get-theme-color("surface", "a20") !important;
    border-color: get-theme-color("primary", "a10") !important;
  }

  &:focus {
    outline: 2px solid get-theme-color("primary", "a0");
    outline-offset: 2px;
  }

  span {
    margin-right: 0.5rem;
    color: get-theme-color("primary", "a20");
  }
}

.noFormats {
  color: get-theme-color("text", "a30");
  font-size: 0.875rem;
  padding: 0.5rem 0;
}

// Book Info Section
.formFields {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.fieldRow {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 0.75rem;
  align-items: end;
  min-width: 0;

  > * {
    min-width: 0;
  }
}

.field {
  min-width: 0;
}

.arrowButton {
  background: none;
  border: none;
  color: get-theme-color("text", "a30");
  cursor: pointer;
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  transition: all 0.2s;
  align-self: flex-end;
  margin-bottom: 0.5rem;

  &:hover {
    color: get-theme-color("primary", "a0");
    transform: translateX(2px);
  }

  &:focus {
    outline: 2px solid get-theme-color("primary", "a0");
    outline-offset: 2px;
    border-radius: 0.25rem;
  }
}

.tagActions {
  display: flex;
  justify-content: flex-end;
  margin-top: -0.5rem;
}

.tagActionsColumn {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  width: 100%;
}

.tagActionsLabel {
  font-size: 0.875rem;
  font-weight: 500;
  color: get-theme-color("text", "a10");
  line-height: 1.5;
  height: 1.3125rem; // Matches TagInput label height (0.875rem * 1.5)
}

.tagActionsButton {
  height: 2.75rem; // Matches TagInput tagsContainer min-height
  width: auto;
  align-self: flex-start;
}

// Footer
.footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  padding: 1rem 1.5rem 1.5rem;
  border-top: 1px solid get-theme-color("surface", "a20");
  background-color: get-theme-color("surface-tonal", "a10");
}

.statusMessages {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  flex: 1;
}

.errorBanner {
  padding: 0.75rem 1rem;
  background-color: get-theme-color("danger", "a20");
  color: get-theme-color("danger", "a0");
  border-radius: 0.375rem;
  font-size: 0.875rem;
  line-height: 1.5;
}

.successBanner {
  padding: 0.75rem 1rem;
  background-color: get-theme-color("success", "a20");
  color: get-theme-color("success", "a0");
  border-radius: 0.375rem;
  font-size: 0.875rem;
  line-height: 1.5;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.footerActions {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  flex-shrink: 0;
}

.loading,
.error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 50vh;
  gap: 1rem;
  color: get-theme-color("text", "a30");
  font-size: 1rem;
  padding: 2rem;
}

@media (max-width: 1400px) {
  .seriesRow {
    grid-template-columns: 2fr 1fr;
    gap: 0.75rem;

    .ratingField {
      grid-column: 1 / -1;
    }
  }
}

@media (max-width: 1024px) {
  .content {
    grid-template-columns: 1fr;
  }

  .leftSidebar {
    order: 2;
  }

  .mainContent {
    order: 1;
  }

  .formGrid {
    grid-template-columns: 1fr;
  }

  .seriesRow {
    grid-template-columns: 1fr;
  }

  .spanningRow {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .modalOverlay {
    padding: 0.5rem;
  }

  .modal {
    max-height: 98vh;
    border-radius: 0.75rem;
  }

  .header {
    padding: 1rem;
    flex-direction: column;
    align-items: stretch;
  }

  .title {
    font-size: 1.125rem;
  }

  .downloadMetadataButton {
    width: 100%;
  }

  .content {
    padding: 1rem;
    gap: 1rem;
  }

  .formGrid {
    grid-template-columns: 1fr;
  }

  .seriesRow {
    grid-template-columns: 1fr;
  }

  .spanningRow {
    grid-template-columns: 1fr;
  }

  .fieldRow {
    grid-template-columns: 1fr;
    gap: 0.5rem;

    .arrowButton {
      display: none;
    }
  }

  .footer {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }

  .statusMessages {
    width: 100%;
  }

  .footerActions {
    flex-direction: column-reverse;
    width: 100%;

    button {
      width: 100%;
    }
  }
}
